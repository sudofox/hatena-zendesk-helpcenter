{"article":{"id":900006365223,"url":"https://mackerelio.zendesk.com/api/v2/help_center/en-us/articles/900006365223.json","html_url":"https://support.mackerel.io/hc/en-us/articles/900006365223-Is-it-possible-to-download-metrics-and-monitors-","author_id":390085917472,"comments_disabled":true,"draft":false,"promoted":false,"position":5,"vote_sum":0,"vote_count":0,"section_id":360007911812,"created_at":"2021-03-30T07:28:35Z","updated_at":"2021-12-21T08:53:23Z","name":"Is it possible to download metrics and monitors?","title":"Is it possible to download metrics and monitors?","source_locale":"ja","locale":"en-us","outdated":false,"outdated_locales":[],"edited_at":"2021-04-28T09:21:36Z","user_segment_id":null,"permission_group_id":1305651,"content_tag_ids":[],"label_names":["エクスポート","インポート","取得","データ取得"],"body":"\u003cp\u003e\u003cspan style=\"font-weight: 400;\"\u003eYes, the metrics and monitors that Mackerel manages can be downloaded using the API or CLI tool.\u003c/span\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eDownloading in CSV format from the web console is not supported.\u003c/span\u003e\u003c/li\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eBoth the API and CLI tool are output in JSON format.\u003c/span\u003e\u003c/li\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eSee the document linked below for how to install and use the CLI tool.\u003c/span\u003e\u003c/li\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"2\"\u003e\u003ca href=\"https://mackerel.io/docs/entry/advanced/cli\" target=\"_blank\" rel=\"noopener\"\u003eUsing the CLI tool mkr - Mackerel Help\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cspan style=\"font-weight: 400;\"\u003eHere are some useful links and command samples on how to retrieve metrics and monitors.\u003c/span\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003ca href=\"#h_01F4BWFDZGH95EAEMKAN5SHNQW\" target=\"_self\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eHow to retrieve metrics with the API\u003c/span\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003ca href=\"#h_01F4BWFQN7CPGEQPRWN9B15VK5\" target=\"_self\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eHow to retrieve metrics with the CLI tool (mkr)\u003c/span\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003ca href=\"#h_01F4BWFZBAYZQYVMHN4SYMTR98\" target=\"_self\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eHow to retrieve monitors with the API\u003c/span\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003ca href=\"#h_01F4BWGDFRAA2BF0D282DVJBZY\" target=\"_self\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eHow to retrieve monitors with the CLI tool (mkr)\u003c/span\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"h_01F4BWFDZGH95EAEMKAN5SHNQW\"\u003eHow to retrieve metrics with the API\u003c/h4\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003cspan style=\"font-weight: 400;\"\u003e See the API documents linked below for details regarding the Get Metrics API.\u003c/span\u003e\u003c/li\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"2\"\u003e\u003ca href=\"https://mackerel.io/api-docs/entry/host-metrics#get\" target=\"_blank\" rel=\"noopener\"\u003eGet Host Metrics - Mackerel API Document (v0) \u003c/a\u003e\u003c/li\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"2\"\u003e\u003ca href=\"https://mackerel.io/api-docs/entry/service-metrics#get\" target=\"_blank\" rel=\"noopener\"\u003eGet Service Metrics - Mackerel API Document (v0) \u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eRefer to the document below to view the names of system metrics posted by mackerel-agent.\u003c/span\u003e\u003c/li\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"2\"\u003e\u003ca href=\"https://mackerel.io/docs/entry/spec/metrics\" target=\"_blank\" rel=\"noopener\"\u003eMetric Specifications - Mackerel Help \u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\n\u003cspan style=\"font-weight: 400;\"\u003eFor the names of custom metrics for plugins, refer to the host details screen or \u003ca href=\"https://mackerel.io/my/graph-defs\" target=\"_blank\" rel=\"noopener\"\u003egraph definition\u003c/a\u003e screen.\u003c/span\u003e\u003cspan style=\"font-weight: 400;\"\u003e\u003cbr\u003e\u003c/span\u003e\u003cspan style=\"font-weight: 400;\"\u003e（See the \"\u003ca href=\"https://mackerel.io/ja/docs/entry/advanced/custom-metrics#graph-schema\" target=\"_blank\" rel=\"noopener\"\u003eDefining Graph Schema\u003c/a\u003e\" section for graph definitions)\u003c/span\u003e\n\u003c/li\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eBelow is an example of how to retrieve the metric loadavg1 with the curl command.\u003c/span\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003cspan style=\"font-weight: 400;\"\u003e$ curl \\\u003cbr\u003e-s https://api.mackerelio.com/api/v0/hosts/\u003cem\u003e\u0026lt;HostID\u0026gt;\u003c/em\u003e/metrics?name=loadavg1\u0026amp;from=\u003cem\u003e\u0026lt;unixtime\u0026gt;\u003c/em\u003e\u0026amp;to=\u003cem\u003e\u0026lt;unixtime\u0026gt;\u003c/em\u003e \\\u003cbr\u003e-H 'Content-Type: application/json' \\\u003cbr\u003e-H 'X-Api-Key: \u003cem\u003e\u0026lt;API key\u0026gt;\u003c/em\u003e' \\\u003cbr\u003e-X GET\u003cbr\u003e\u003cbr\u003e{\"metrics\":[{\"time\":1617163080,\"value\":0.27},{\"time\":1617163140,\"value\":0.13}, ...]}\u003c/span\u003e\u003c/pre\u003e\n\u003ch4 id=\"h_01F4BWFQN7CPGEQPRWN9B15VK5\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eHow to retrieve metrics with the CLI tool (mkr)\u003c/span\u003e\u003c/h4\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eMetrics can be retrieved with mkr metrics or mkr fetch.\u003c/span\u003e\u003c/li\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eBelow is an example of how to retrieve the metric loadavg1 with the mkr metrics command.\u003c/span\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003cspan style=\"font-weight: 400;\"\u003e$ mkr metrics --host \u003cem\u003e\u0026lt;HostID\u0026gt; \u003c/em\u003e--name loadavg1 --from \u003cem\u003e\u0026lt;unixtime\u0026gt;\u003c/em\u003e --to \u003cem\u003e\u0026lt;unixtime\u0026gt;\u003cbr\u003e[\u003cbr\u003e{\u003cbr\u003e\"time\": 1617163080,\u003cbr\u003e\"value\": 0.27\u003cbr\u003e},\u003cbr\u003e:\u003cbr\u003e\u003c/em\u003e]\u003c/span\u003e\u003c/pre\u003e\n\u003ch4 id=\"h_01F4BWFZBAYZQYVMHN4SYMTR98\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eHow to retrieve monitors with the API\u003c/span\u003e\u003c/h4\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eSee the API documents linked below for details regarding the Get Monitor Configurations API.\u003c/span\u003e\u003c/li\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"2\"\u003e\u003ca href=\"https://mackerel.io/api-docs/entry/monitors#list%C2%A0\" target=\"_blank\" rel=\"noopener\"\u003eList Monitor Configurations - Mackerel API Document (v0)\u003c/a\u003e\u003c/li\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"2\"\u003e\u003ca href=\"https://mackerel.io/api-docs/entry/monitors#get\" target=\"_blank\" rel=\"noopener\"\u003eGet Monitor Configurations - Mackerel API Document (v0)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\n\u003cspan style=\"font-weight: 400;\"\u003eTo retrieve a particular monitor configuration using the Get Monitor Configurations API, specify one of the following values for \u003c/span\u003e\u003cem\u003e\u003cspan style=\"font-weight: 400;\"\u003emonitorId\u003c/span\u003e\u003c/em\u003e\u003cspan style=\"font-weight: 400;\"\u003e.\u003c/span\u003e\n\u003c/li\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"2\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eThe id of the respective monitoring rule included in the API response.\u003c/span\u003e\u003c/li\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"2\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eThe \"monitor=\u003cstrong\u003exxxxxxx\u003c/strong\u003e\" value located in the URL when accessing the monitor’s details screen from the Web console.\u003c/span\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eFor check monitoring, you can view the monitorId set for each host using the List Monitoring Statuses API.\u003c/span\u003e\u003c/li\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"2\"\u003e\u003ca href=\"https://mackerel.io/api-docs/entry/hosts#monitored-statuses\" target=\"_blank\" rel=\"noopener\"\u003eList Monitoring Statuses - Mackerel API Document (v0)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eBelow is an example of how to retrieve a monitor with the curl command.\u003c/span\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003cspan style=\"font-weight: 400;\"\u003e$ curl \\\u003cbr\u003e-s https://api.mackerelio.com/api/v0/monitors/\u003cem\u003e\u0026lt;monitorId\u0026gt;\u003c/em\u003e \\\u003cbr\u003e-H 'Content-Type: application/json' \\\u003cbr\u003e-H 'X-Api-Key: \u003cem\u003e\u0026lt;API Key\u0026gt;\u003c/em\u003e' \\\u003cbr\u003e-X GET\u003cbr\u003e\u003cbr\u003e{\"monitor\":{\"duration\":1,\"maxCheckAttempts\":3,\"critical\":95,\"isMute\":false,\"metric\":\"cpu%\",\"excludeScopes\":[],\"name\":\"CPU %\",\"warning\":80,\"id\":\"xxxxxxxx\",\"scopes\":[],\"type\":\"host\",\"operator\":\"\u0026gt;\"}}\u003c/span\u003e\u003c/pre\u003e\n\u003ch4 id=\"h_01F4BWGDFRAA2BF0D282DVJBZY\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eHow to retrieve monitors with the CLI tool (mkr)\u003c/span\u003e\u003c/h4\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eMonitors can be retrieved with mkr monitors pull.\u003c/span\u003e\u003c/li\u003e\n\u003cul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"2\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eThis only applies to monitors configured from the Web Console.\u003c/span\u003e\u003c/li\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"2\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eThe monitors.json file is created in the directory where the command was executed.\u003c/span\u003e\u003c/li\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"2\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eCheck monitoring requires direct management of mackerel-agent.conf.\u003c/span\u003e\u003c/li\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"2\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eIn addition to pull, mkr monitors also supports diff and push.\u003c/span\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cli style=\"font-weight: 400;\" aria-level=\"1\"\u003e\u003cspan style=\"font-weight: 400;\"\u003eBelow is an example of how to retrieve a monitor with mkr command.\u003c/span\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003cspan style=\"font-weight: 400;\"\u003e$ mkr monitors pull\u003cbr\u003einfo Monitor rules are saved to 'monitors.json' (6 rules).\u003c/span\u003e\u003c/pre\u003e"}}
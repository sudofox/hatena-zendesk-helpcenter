{
  "article": {
    "id": 900006365223,
    "url": "https://mackerelio.zendesk.com/api/v2/help_center/en-us/articles/900006365223.json",
    "html_url": "https://support.mackerel.io/hc/en-us/articles/900006365223-Is-it-possible-to-download-metrics-and-monitors-",
    "author_id": 390085917472,
    "comments_disabled": true,
    "draft": false,
    "promoted": false,
    "position": 5,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 360007911812,
    "created_at": "2021-03-30T07:28:35Z",
    "updated_at": "2021-12-21T08:53:23Z",
    "name": "Is it possible to download metrics and monitors?",
    "title": "Is it possible to download metrics and monitors?",
    "source_locale": "ja",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2021-04-28T09:21:36Z",
    "user_segment_id": null,
    "permission_group_id": 1305651,
    "content_tag_ids": [],
    "label_names": [
      "エクスポート",
      "インポート",
      "取得",
      "データ取得"
    ],
    "body": "<p><span style=\"font-weight: 400;\">Yes, the metrics and monitors that Mackerel manages can be downloaded using the API or CLI tool.</span></p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"font-weight: 400;\">Downloading in CSV format from the web console is not supported.</span></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"font-weight: 400;\">Both the API and CLI tool are output in JSON format.</span></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"font-weight: 400;\">See the document linked below for how to install and use the CLI tool.</span></li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><a href=\"https://mackerel.io/docs/entry/advanced/cli\" target=\"_blank\" rel=\"noopener\">Using the CLI tool mkr - Mackerel Help</a></li>\n</ul>\n</ul>\n<p><span style=\"font-weight: 400;\">Here are some useful links and command samples on how to retrieve metrics and monitors.</span></p>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><a href=\"#h_01F4BWFDZGH95EAEMKAN5SHNQW\" target=\"_self\"><span style=\"font-weight: 400;\">How to retrieve metrics with the API</span></a></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><a href=\"#h_01F4BWFQN7CPGEQPRWN9B15VK5\" target=\"_self\"><span style=\"font-weight: 400;\">How to retrieve metrics with the CLI tool (mkr)</span></a></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><a href=\"#h_01F4BWFZBAYZQYVMHN4SYMTR98\" target=\"_self\"><span style=\"font-weight: 400;\">How to retrieve monitors with the API</span></a></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><a href=\"#h_01F4BWGDFRAA2BF0D282DVJBZY\" target=\"_self\"><span style=\"font-weight: 400;\">How to retrieve monitors with the CLI tool (mkr)</span></a></li>\n</ul>\n<h4 id=\"h_01F4BWFDZGH95EAEMKAN5SHNQW\">How to retrieve metrics with the API</h4>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"font-weight: 400;\"> See the API documents linked below for details regarding the Get Metrics API.</span></li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><a href=\"https://mackerel.io/api-docs/entry/host-metrics#get\" target=\"_blank\" rel=\"noopener\">Get Host Metrics - Mackerel API Document (v0) </a></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><a href=\"https://mackerel.io/api-docs/entry/service-metrics#get\" target=\"_blank\" rel=\"noopener\">Get Service Metrics - Mackerel API Document (v0) </a></li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"font-weight: 400;\">Refer to the document below to view the names of system metrics posted by mackerel-agent.</span></li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><a href=\"https://mackerel.io/docs/entry/spec/metrics\" target=\"_blank\" rel=\"noopener\">Metric Specifications - Mackerel Help </a></li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">\n<span style=\"font-weight: 400;\">For the names of custom metrics for plugins, refer to the host details screen or <a href=\"https://mackerel.io/my/graph-defs\" target=\"_blank\" rel=\"noopener\">graph definition</a> screen.</span><span style=\"font-weight: 400;\"><br></span><span style=\"font-weight: 400;\">（See the \"<a href=\"https://mackerel.io/ja/docs/entry/advanced/custom-metrics#graph-schema\" target=\"_blank\" rel=\"noopener\">Defining Graph Schema</a>\" section for graph definitions)</span>\n</li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"font-weight: 400;\">Below is an example of how to retrieve the metric loadavg1 with the curl command.</span></li>\n</ul>\n<pre><span style=\"font-weight: 400;\">$ curl \\<br>-s https://api.mackerelio.com/api/v0/hosts/<em>&lt;HostID&gt;</em>/metrics?name=loadavg1&amp;from=<em>&lt;unixtime&gt;</em>&amp;to=<em>&lt;unixtime&gt;</em> \\<br>-H 'Content-Type: application/json' \\<br>-H 'X-Api-Key: <em>&lt;API key&gt;</em>' \\<br>-X GET<br><br>{\"metrics\":[{\"time\":1617163080,\"value\":0.27},{\"time\":1617163140,\"value\":0.13}, ...]}</span></pre>\n<h4 id=\"h_01F4BWFQN7CPGEQPRWN9B15VK5\"><span style=\"font-weight: 400;\">How to retrieve metrics with the CLI tool (mkr)</span></h4>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"font-weight: 400;\">Metrics can be retrieved with mkr metrics or mkr fetch.</span></li>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"font-weight: 400;\">Below is an example of how to retrieve the metric loadavg1 with the mkr metrics command.</span></li>\n</ul>\n<pre><span style=\"font-weight: 400;\">$ mkr metrics --host <em>&lt;HostID&gt; </em>--name loadavg1 --from <em>&lt;unixtime&gt;</em> --to <em>&lt;unixtime&gt;<br>[<br>{<br>\"time\": 1617163080,<br>\"value\": 0.27<br>},<br>:<br></em>]</span></pre>\n<h4 id=\"h_01F4BWFZBAYZQYVMHN4SYMTR98\"><span style=\"font-weight: 400;\">How to retrieve monitors with the API</span></h4>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"font-weight: 400;\">See the API documents linked below for details regarding the Get Monitor Configurations API.</span></li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><a href=\"https://mackerel.io/api-docs/entry/monitors#list%C2%A0\" target=\"_blank\" rel=\"noopener\">List Monitor Configurations - Mackerel API Document (v0)</a></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><a href=\"https://mackerel.io/api-docs/entry/monitors#get\" target=\"_blank\" rel=\"noopener\">Get Monitor Configurations - Mackerel API Document (v0)</a></li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\">\n<span style=\"font-weight: 400;\">To retrieve a particular monitor configuration using the Get Monitor Configurations API, specify one of the following values for </span><em><span style=\"font-weight: 400;\">monitorId</span></em><span style=\"font-weight: 400;\">.</span>\n</li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><span style=\"font-weight: 400;\">The id of the respective monitoring rule included in the API response.</span></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><span style=\"font-weight: 400;\">The \"monitor=<strong>xxxxxxx</strong>\" value located in the URL when accessing the monitor’s details screen from the Web console.</span></li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"font-weight: 400;\">For check monitoring, you can view the monitorId set for each host using the List Monitoring Statuses API.</span></li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><a href=\"https://mackerel.io/api-docs/entry/hosts#monitored-statuses\" target=\"_blank\" rel=\"noopener\">List Monitoring Statuses - Mackerel API Document (v0)</a></li>\n</ul>\n</ul>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"font-weight: 400;\">Below is an example of how to retrieve a monitor with the curl command.</span></li>\n</ul>\n<pre><span style=\"font-weight: 400;\">$ curl \\<br>-s https://api.mackerelio.com/api/v0/monitors/<em>&lt;monitorId&gt;</em> \\<br>-H 'Content-Type: application/json' \\<br>-H 'X-Api-Key: <em>&lt;API Key&gt;</em>' \\<br>-X GET<br><br>{\"monitor\":{\"duration\":1,\"maxCheckAttempts\":3,\"critical\":95,\"isMute\":false,\"metric\":\"cpu%\",\"excludeScopes\":[],\"name\":\"CPU %\",\"warning\":80,\"id\":\"xxxxxxxx\",\"scopes\":[],\"type\":\"host\",\"operator\":\"&gt;\"}}</span></pre>\n<h4 id=\"h_01F4BWGDFRAA2BF0D282DVJBZY\"><span style=\"font-weight: 400;\">How to retrieve monitors with the CLI tool (mkr)</span></h4>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"font-weight: 400;\">Monitors can be retrieved with mkr monitors pull.</span></li>\n<ul>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><span style=\"font-weight: 400;\">This only applies to monitors configured from the Web Console.</span></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><span style=\"font-weight: 400;\">The monitors.json file is created in the directory where the command was executed.</span></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><span style=\"font-weight: 400;\">Check monitoring requires direct management of mackerel-agent.conf.</span></li>\n<li style=\"font-weight: 400;\" aria-level=\"2\"><span style=\"font-weight: 400;\">In addition to pull, mkr monitors also supports diff and push.</span></li>\n</ul>\n<li style=\"font-weight: 400;\" aria-level=\"1\"><span style=\"font-weight: 400;\">Below is an example of how to retrieve a monitor with mkr command.</span></li>\n</ul>\n<pre><span style=\"font-weight: 400;\">$ mkr monitors pull<br>info Monitor rules are saved to 'monitors.json' (6 rules).</span></pre>"
  }
}

{
  "article": {
    "id": 900006365223,
    "url": "https://mackerelio.zendesk.com/api/v2/help_center/ja/articles/900006365223.json",
    "html_url": "https://support.mackerel.io/hc/ja/articles/900006365223",
    "author_id": 390085917472,
    "comments_disabled": true,
    "draft": false,
    "promoted": false,
    "position": 5,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 360007911812,
    "created_at": "2021-03-30T07:28:35Z",
    "updated_at": "2025-03-12T02:51:51Z",
    "name": "メトリックや監視ルールをダウンロードすることは出来ますか？",
    "title": "メトリックや監視ルールをダウンロードすることは出来ますか？",
    "source_locale": "ja",
    "locale": "ja",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2025-03-12T02:51:51Z",
    "user_segment_id": null,
    "permission_group_id": 1305651,
    "content_tag_ids": [],
    "label_names": [
      "エクスポート",
      "インポート",
      "取得",
      "データ取得"
    ],
    "body": "<p>投稿されたメトリックや監視ルールは、 <a href=\"https://mackerel.io/ja/api-docs/\">API</a> もしくはCLI ツールの <a href=\"https://mackerel.io/ja/docs/entry/advanced/cli\">mkr</a> にてダウンロードできます。</p>\n<p>このページでは Linux 環境で curl コマンドを使ったサンプルを紹介します。他の環境で API を実行する場合は適宜コマンドなどを置き換えて実行してください。</p>\n<ul>\n<li><a href=\"#h_01J9XE0J3Y0D4A29T9T5W4XPC1\">ダウンロードに関して</a></li>\n<li><a href=\"#h_01J9XE0J3YY825NHEKHGW2G5TS\">メトリックのダウンロード</a></li>\n<li>\n<a href=\"#h_01J9XE0J3YQQ7MM19TJ3F6VVSV\">メトリックの取得に関して</a>\n<ul>\n<li><a href=\"#h_01J9XE0J3YXBV9W8CCJYTH65YJ\">APIによるメトリックの取得方法</a></li>\n<li><a href=\"#h_01J9XE0J3YTZ89JJ70KZZG51KG\">mkrによるメトリックの取得方法</a></li>\n</ul>\n</li>\n<li>\n<a href=\"#h_01J9XE0J3YFNR3DPS9KJKAKDMY\">監視ルールのダウンロード</a>\n<ul>\n<li><a href=\"#h_01J9XE0J3YGG7SFMG3JTFMQBR9\">APIによる監視ルールの取得方法</a></li>\n<li><a href=\"#h_01J9XE0J3YNQAPHKA7YJJTRW7W\">mkrによる監視ルールの取得方法</a></li>\n</ul>\n</li>\n<li><a href=\"#h_01J9XE0J3Y82BZR9K7H5NVQC6V\">JSON形式で出力された内容をCSV形式へ変換する</a></li>\n</ul>\n<h2 id=\"h_01J9XE0J3Y0D4A29T9T5W4XPC1\">ダウンロードに関して</h2>\n<ul>\n<li>\n<p>Webコンソールからのダウンロードには対応していません。</p>\n</li>\n<li>\n<p>ダウンロードできるのはAPIによる取得が可能な項目に限ります。</p>\n</li>\n<li>\n<p>監視ルールのうち、チェック監視についてはダウンロードに対応していません。</p>\n</li>\n<li>\n<p>APIおよびmkrいずれの場合も出力フォーマットはJSON形式となります。</p>\n</li>\n<li>\n<p>CSV形式での出力方法については「 <a href=\"#h_01J9XE0J3Y82BZR9K7H5NVQC6V\">JSON形式で出力された内容をCSV形式へ変換する</a>」をご参照ください。</p>\n</li>\n<li>\n<p>mkrを使用する場合は事前に <a href=\"https://mackerel.io/ja/docs/entry/advanced/cli\">こちらのページ</a> を参考にインストールしてください。</p>\n<ul>\n<li>Windows環境ではmackerel-agentに同梱されています。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"h_01J9XE0J3YY825NHEKHGW2G5TS\">メトリックのダウンロード</h2>\n<h3 id=\"h_01J9XE0J3YQQ7MM19TJ3F6VVSV\">メトリックの取得に関して</h3>\n<ul>\n<li>指定するメトリック名に関して - mackerel-agent が投稿するシステムメトリック名は以下をご参照ください。\n<ul>\n<li><a href=\"https://mackerel.io/ja/docs/entry/spec/metrics\">メトリック仕様 - Mackerel ヘルプ</a></li>\n<li>プラグインによって登録されたカスタムメトリック名は次のような方法でご確認ください。\n<ul>\n<li>オーガニゼーションの <a href=\"https://mackerel.io/my/graph-defs\">グラフ定義</a> から確認する（グラフ定義については <a href=\"https://mackerel.io/ja/docs/entry/advanced/custom-metrics#graph-schema\">「グラフ定義を指定する」</a> をご参照ください）。</li>\n<li>mkr metric-names -H &lt;ホストID&gt; を実行し、ホストに登録されているメトリックを確認する。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>指定する期間に関して\n<ul>\n<li>epoch秒（UNIX時間）で指定します。</li>\n<li>APIおよびmkrでメトリックを取得する際、指定した期間に応じてメトリックの粒度が変化し、取得できる値もその粒度での平均値になります。1分粒度の値を取得する場合は、指定する期間を20時間以下にしてください。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"h_01J9XE0J3YXBV9W8CCJYTH65YJ\">APIによるメトリックの取得方法</h3>\n<ul>\n<li>メトリック取得APIに関する詳細は、以下のAPIドキュメントをご参照ください。\n<ul>\n<li><a href=\"https://mackerel.io/ja/api-docs/entry/host-metrics#get\">ホストのメトリックの値の取得 - Mackerel API ドキュメント (v0)</a></li>\n<li><a href=\"https://mackerel.io/ja/api-docs/entry/service-metrics#get\">サービスメトリックの値の取得 - Mackerel API ドキュメント (v0)</a></li>\n</ul>\n</li>\n<li>以下は curl コマンドを使って loadavg1 のメトリックを取得するサンプルです。</li>\n</ul>\n<pre><code>$ curl \\\n-s https://api.mackerelio.com/api/v0/hosts/&lt;ホストID&gt;/metrics?name=loadavg1&amp;from=&lt;epoch秒&gt;&amp;to=&lt;epoch秒&gt; \\\n-H 'Content-Type: application/json' \\\n-H 'X-Api-Key: &lt;APIキー&gt;' \\\n-X GET\n\n{\"metrics\":[{\"time\":1617163080,\"value\":0.27},{\"time\":1617163140,\"value\":0.13}, ...]}\n</code></pre>\n<h3 id=\"h_01J9XE0J3YTZ89JJ70KZZG51KG\">mkrによるメトリックの取得方法</h3>\n<ul>\n<li>mkr metrics や mkr fetch にて取得できます。</li>\n<li>以下は mkr metrics コマンドを使って loadavg1 のメトリックを取得するサンプルです。</li>\n</ul>\n<pre><code>$ mkr metrics --host &lt;ホストID&gt; --name loadavg1 --from &lt;epoch秒&gt; --to &lt;epoch秒&gt;\n[\n  {\n    \"time\": 1617163080,\n    \"value\": 0.27\n  },\n  :\n]\n</code></pre>\n<h2 id=\"h_01J9XE0J3YFNR3DPS9KJKAKDMY\">監視ルールのダウンロード</h2>\n<h3 id=\"h_01J9XE0J3YGG7SFMG3JTFMQBR9\">APIによる監視ルールの取得方法</h3>\n<ul>\n<li>監視ルール取得APIに関する情報は、以下のAPIドキュメントをご参照ください。\n<ul>\n<li><a href=\"https://mackerel.io/ja/api-docs/entry/monitors#list\">監視ルールの一覧 - Mackerel API ドキュメント (v0)</a></li>\n<li><a href=\"https://mackerel.io/ja/api-docs/entry/monitors#get\">監視ルールの取得 - Mackerel API ドキュメント (v0)</a></li>\n</ul>\n</li>\n<li>監視ルールの取得APIで個別に監視ルールを取得する場合、 <em>monitorId</em> に指定する値は以下のいずれかを参考に指定してください。\n<ul>\n<li>監視ルールの一覧APIのレスポンスに含まれる、各監視ルールの <em>id</em> の値</li>\n<li>Webコンソールで監視ルール詳細画面を開いたURL中の「monitor= <strong><em>xxxxxxx</em></strong>」の値</li>\n</ul>\n</li>\n<li>以下は curl コマンドを使って監視ルールを取得するサンプルです。</li>\n</ul>\n<pre><code>$ curl \\\n-s https://api.mackerelio.com/api/v0/monitors/&lt;monitorId&gt; \\\n-H 'Content-Type: application/json' \\\n-H 'X-Api-Key: &lt;APIキー&gt;' \\\n-X GET\n\n{\"monitor\":{\"duration\":1,\"maxCheckAttempts\":3,\"critical\":95,\"isMute\":false,\"metric\":\"cpu%\",\"excludeScopes\":[],\"name\":\"CPU %\",\"warning\":80,\"id\":\"xxxxxxxx\",\"scopes\":[],\"type\":\"host\",\"operator\":\"&gt;\"}}\n</code></pre>\n<h3 id=\"h_01J9XE0J3YNQAPHKA7YJJTRW7W\">mkrによる監視ルールの取得方法</h3>\n<ul>\n<li>mkr monitors pull にて取得できます。\n<ul>\n<li>コマンドが実行されたディレクトリに monitors.json が作成されます。</li>\n<li>mkr monitors は pull（取得）のほか、diff（差分確認）や push（更新）にも対応しています。</li>\n</ul>\n</li>\n<li>以下は mkr monitors コマンドを使って監視ルールを取得するサンプルです。</li>\n</ul>\n<pre><code>$ mkr monitors pull\ninfo Monitor rules are saved to 'monitors.json' (6 rules).\n</code></pre>\n<h2 id=\"h_01J9XE0J3Y82BZR9K7H5NVQC6V\">JSON形式で出力された内容をCSV形式へ変換する</h2>\n<p>APIからのレスポンスであるJSON文字列をjqコマンドにパイプして渡すことで、jqでフィルター処理をしてCSV形式へ変換できます。</p>\n<pre><code>$ curl \\\n-s https://api.mackerelio.com/api/v0/hosts/&lt;ホストID&gt;/metrics?name=loadavg1&amp;from=&lt;epoch秒&gt;&amp;to=&lt;epoch秒&gt; \\\n-H 'Content-Type: application/json' \\\n-H 'X-Api-Key: &lt;APIキー&gt;' \\\n-X GET \\\n| jq '.[] | .[] | [.time, .value] | @csv'\n\n1617163080,0.27\n1617163140,0.13\n:\n</code></pre>\n<p>mkrも同様に--jqオプションでフィルター処理をしてCSV形式へ変換できます（ <a href=\"https://github.com/itchyny/gojq\">gojq</a> の仕様に準拠します）。</p>\n<pre><code>mkr metrics --host &lt;ホストID&gt; --name loadavg1 --from &lt;epoch秒&gt; --to &lt;epoch秒&gt; --jq '.[] | [.time,.value] | @csv'\n\n1617163080,0.27\n1617163140,0.13\n:\n</code></pre>\n"
  }
}

{
  "article": {
    "id": 900006365223,
    "url": "https://mackerelio.zendesk.com/api/v2/help_center/ja/articles/900006365223.json",
    "html_url": "https://support.mackerel.io/hc/ja/articles/900006365223",
    "author_id": 390085917472,
    "comments_disabled": true,
    "draft": false,
    "promoted": false,
    "position": 5,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 360007911812,
    "created_at": "2021-03-30T07:28:35Z",
    "updated_at": "2023-05-16T03:19:56Z",
    "name": "メトリックや監視ルールをダウンロードすることは出来ますか？",
    "title": "メトリックや監視ルールをダウンロードすることは出来ますか？",
    "source_locale": "ja",
    "locale": "ja",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2023-05-16T03:19:56Z",
    "user_segment_id": null,
    "permission_group_id": 1305651,
    "content_tag_ids": [],
    "label_names": [
      "エクスポート",
      "インポート",
      "取得",
      "データ取得"
    ],
    "body": "<p>APIもしくはCLIツール mkr にてダウンロードできます。</p>\n<h2><span style=\"font-size: 1.5em; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">ダウンロードに関する仕様</span></h2>\n<p>ダウンロードに関する仕様は次の通りです。</p>\n<ul>\n<li>\n<span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">投稿されているメトリックの値や監視ルールなど、APIによる取得が可能な項目に限ります。</span>\n<ul>\n<li><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">監視ルールのうち、チェック監視についてはダウンロードに対応していません。</span></li>\n</ul>\n</li>\n<li>\n<span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">出力フォーマットはJSON形式となります。</span>\n<ul>\n<li>APIによる取得の場合、CSV形式の出力には非対応です。jqなどの外部のユーティリティを併用してください。</li>\n<li>mkrでは--jqオプションにてCSV形式へ変換できます。\n<ul>\n<li>--jqオプションについては、<a style=\"background-color: #ffffff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\" href=\"https://github.com/itchyny/gojq\" target=\"_blank\" rel=\"noopener noreferrer\">gojq</a><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">の仕様に準拠します。</span>\n</li>\n</ul>\n</li>\n<li><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">CSV形式への出力については「<a href=\"#h_01H096AFA2F1QTP2CPDPZGNJ5X\" target=\"_self\">JSON形式で出力された内容をCSV形式へ変換する</a>」をご確認ください。</span></li>\n</ul>\n</li>\n<li><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">Webコンソールからのダウンロードには対応していません。</span></li>\n</ul>\n<h2>ダウンロード方法</h2>\n<p><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">取得可能な項目のうち、メトリックと監視ルールのダウンロード方法について、API・CLIツール mkr のそれぞれでご紹介します。</span><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">Linux環境でcurlを使ったサンプルとなりますが、他の環境でAPIを実行する場合は適宜コマンドなどを置き換えてお試しください。</span></p>\n<p>なお、mkr を使用する場合は、事前に<a href=\"https://mackerel.io/ja/docs/entry/advanced/cli\" target=\"_blank\" rel=\"noopener\">こちらのページ</a>を参考にインストールしてください。（Windows環境ではmackerel-agentに同梱されています。）</p>\n<ul>\n<li><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\"><a href=\"#h_01F3BYDQJM4YAJQ18BPKEKYKPG\" target=\"_self\">APIによるメトリックの取得方法</a></span></li>\n<li><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\"><a href=\"#h_01F3BYE0P9W9PQ4RKXZQGQV1VX\" target=\"_self\" rel=\"undefined\">mkrによるメトリックの取得方法</a></span></li>\n<li><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\"><a href=\"#h_01F3BYE72H6JS63B85NTF4Z0Q9\" target=\"_self\">APIによる監視ルールの取得方法</a></span></li>\n<li><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\"><a href=\"#h_01F3BYECQYZ3ARJHY8BWK23YQ3\" target=\"_self\" rel=\"undefined\">mkrによる監視ルールの取得方法</a></span></li>\n<li><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\"><a href=\"#h_01GZ2HB22XMFARB9Q8DF6N4J7A\" target=\"_self\">その他、便利なTips</a></span></li>\n</ul>\n<h3 id=\"h_01F3BYDQJM4YAJQ18BPKEKYKPG\"><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\">APIによるメトリックの取得方法</span></h3>\n<ul>\n<li> メトリック取得APIに関する詳細は、以下のAPIドキュメントをご確認ください。\n<ul>\n<li><a href=\"https://mackerel.io/ja/api-docs/entry/host-metrics#get\" target=\"_blank\" rel=\"noopener noreferrer\">ホストのメトリックの値の取得 - Mackerel API ドキュメント (v0) </a></li>\n<li><a href=\"https://mackerel.io/ja/api-docs/entry/service-metrics#get\" target=\"_blank\" rel=\"noopener noreferrer\">サービスメトリックの値の取得 - Mackerel API ドキュメント (v0) </a></li>\n</ul>\n</li>\n<li>mackerel-agent が投稿するシステムメトリック名は以下をご確認ください。\n<ul>\n<li><a href=\"https://mackerel.io/ja/docs/entry/spec/metrics\" target=\"_blank\" rel=\"noopener noreferrer\">メトリック仕様 - Mackerel ヘルプ </a></li>\n</ul>\n</li>\n<li>プラグインによって登録されたカスタムメトリック名は次のような方法でご確認ください。\n<ul>\n<li>オーガニゼーションの<a href=\"https://mackerel.io/my/graph-defs\" target=\"_blank\" rel=\"noopener noreferrer\">グラフ定義</a>から確認する（グラフ定義については<a style=\"background-color: #ffffff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\" href=\"https://mackerel.io/ja/docs/entry/advanced/custom-metrics#graph-schema\" target=\"_blank\" rel=\"noopener noreferrer\">「グラフ定義を指定する」</a><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">をご参照ください）。</span>\n</li>\n<li>mkr status -v &lt;ホストID&gt; を実行し、ホストに登録されているメトリックを確認する。</li>\n</ul>\n</li>\n<li>以下は curl コマンドによるloadavg1のメトリックを取得するサンプルです。</li>\n</ul>\n<pre>$ curl \\<br>-s https://api.mackerelio.com/api/v0/hosts/<em>&lt;ホストID&gt;</em>/metrics?name=loadavg1&amp;from=<em>&lt;unixtime&gt;</em>&amp;to=<em>&lt;unixtime&gt;</em> \\<br>-H 'Content-Type: application/json' \\<br>-H 'X-Api-Key: <em>&lt;APIキー&gt;</em>' \\<br>-X GET<br><br>{\"metrics\":[{\"time\":1617163080,\"value\":0.27},{\"time\":1617163140,\"value\":0.13}, ...]}</pre>\n<h3 id=\"h_01F3BYE0P9W9PQ4RKXZQGQV1VX\"><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\">mkrによるメトリックの取得方法</span></h3>\n<ul>\n<li>mkr metrics や mkr fetch にて取得できます。</li>\n<li>以下は mkr metrics コマンドによるloadavg1のメトリックを取得するサンプルです。</li>\n</ul>\n<pre>$ mkr metrics --host <em>&lt;ホストID&gt; </em>--name loadavg1 --from <em>&lt;unixtime&gt;</em> --to <em>&lt;unixtime&gt;<br>[<br>  {<br>    \"time\": 1617163080,<br>    \"value\": 0.27<br>  },<br>  :<br></em>]</pre>\n<h3 id=\"h_01F3BYE72H6JS63B85NTF4Z0Q9\"><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\">APIによる監視ルールの取得方法</span></h3>\n<ul>\n<li>監視ルール取得APIに関する情報は、以下のAPIドキュメントをご確認ください。\n<ul>\n<li><a href=\"https://mackerel.io/ja/api-docs/entry/monitors#list%C2%A0\" target=\"_blank\" rel=\"noopener noreferrer\">監視ルールの一覧 - Mackerel API ドキュメント (v0)</a></li>\n<li><a href=\"https://mackerel.io/ja/api-docs/entry/monitors#get\" target=\"_blank\" rel=\"noopener noreferrer\">監視ルールの取得 - Mackerel API ドキュメント (v0)</a></li>\n</ul>\n</li>\n<li>監視ルール取得APIで個別に監視ルールを取得する場合、<em>monitorId</em> に指定する値は以下のいずれかを参考に指定してください。\n<ul>\n<li>監視ルール一覧APIのレスポンスに含まれる、各監視ルールの <em>id</em> の値</li>\n<li>Webコンソールで監視ルール詳細画面を開いたURL中の「monitor=<strong><em>xxxxxxx</em></strong>」の値</li>\n</ul>\n</li>\n<li>チェック監視の <em>monitorId</em> は監視ステータス一覧APIにて、ホスト毎に設定されているチェック監視の <em>monitorId</em> をご確認いただけます。\n<ul>\n<li><a href=\"https://mackerel.io/ja/api-docs/entry/hosts#monitored-statuses\" target=\"_blank\" rel=\"noopener noreferrer\">監視ステータスの一覧 - Mackerel API ドキュメント (v0)</a></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>以下は curl コマンドによる監視ルールを取得するサンプルです。</li>\n</ul>\n<pre>$ curl \\<br>-s https://api.mackerelio.com/api/v0/monitors/<em>&lt;monitorId&gt;</em> \\<br>-H 'Content-Type: application/json' \\<br>-H 'X-Api-Key: <em>&lt;APIキー&gt;</em>' \\<br>-X GET<br><br>{\"monitor\":{\"duration\":1,\"maxCheckAttempts\":3,\"critical\":95,\"isMute\":false,\"metric\":\"cpu%\",\"excludeScopes\":[],\"name\":\"CPU %\",\"warning\":80,\"id\":\"xxxxxxxx\",\"scopes\":[],\"type\":\"host\",\"operator\":\"&gt;\"}}</pre>\n<h3 id=\"h_01F3BYECQYZ3ARJHY8BWK23YQ3\"><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\">mkrによる監視ルールの取得方法</span></h3>\n<ul>\n<li>mkr monitors pull にて取得できます。\n<ul>\n<li>取得できる監視ルールはWebコンソールで設定いただいた監視ルールのみとなります。</li>\n<li>コマンドが実行されたディレクトリに monitors.json が作成されます。</li>\n<li>チェック監視は mackerel-agent.conf をお手元で管理いただくようお願いします。</li>\n<li>mkr monitors は pull（取得）以外にも、diff（差分確認）や push（更新）にも対応しています。</li>\n</ul>\n</li>\n<li>以下は mkr コマンドによる監視ルールを取得するサンプルです。</li>\n</ul>\n<pre>$ mkr monitors pull<br>      info Monitor rules are saved to 'monitors.json' (6 rules).</pre>\n<h2 id=\"h_01GZ2HB22XMFARB9Q8DF6N4J7A\">便利なTips</h2>\n<h3 id=\"h_01H096AFA2F1QTP2CPDPZGNJ5X\">JSON形式で出力された内容をCSV形式へ変換する</h3>\n<p>APIからのレスポンスであるJSON文字列をjqにパイプして渡すことで、jqでフィルター処理をしてCSVへ変換できます。</p>\n<pre>$ curl \\<br>-s https://api.mackerelio.com/api/v0/hosts/<em>&lt;ホストID&gt;</em>/metrics?name=loadavg1&amp;from=<em>&lt;unixtime&gt;</em>&amp;to=<em>&lt;unixtime&gt;</em> \\<br>-H 'Content-Type: application/json' \\<br>-H 'X-Api-Key: <em>&lt;APIキー&gt;</em>' \\<br>-X GET \\<br>| jq '.[] | .[] | [.time, .value] | @csv'<br><br>1617163080,0.27<br>1617163140,0.13<br> :</pre>\n<p>mkrも同様に--jqオプションでフィルター処理をしてCSVへ変換できます。</p>\n<pre class=\"loom_code prettyprint prettyprinted\">mkr metrics --host hoge --name foo.bar --from xxxxxxx --to xxxxxxx --jq '.[] | [.time,.value] | @csv'<br><br>1617163080,0.27<br>1617163140,0.13<br>:</pre>"
  }
}

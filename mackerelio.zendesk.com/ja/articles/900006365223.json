{
  "article": {
    "id": 900006365223,
    "url": "https://mackerelio.zendesk.com/api/v2/help_center/ja/articles/900006365223.json",
    "html_url": "https://support.mackerel.io/hc/ja/articles/900006365223",
    "author_id": 390085917472,
    "comments_disabled": true,
    "draft": false,
    "promoted": false,
    "position": 5,
    "vote_sum": 0,
    "vote_count": 0,
    "section_id": 360007911812,
    "created_at": "2021-03-30T07:28:35Z",
    "updated_at": "2024-10-04T07:53:44Z",
    "name": "メトリックや監視ルールをダウンロードすることは出来ますか？",
    "title": "メトリックや監視ルールをダウンロードすることは出来ますか？",
    "source_locale": "ja",
    "locale": "ja",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2024-10-04T07:53:44Z",
    "user_segment_id": null,
    "permission_group_id": 1305651,
    "content_tag_ids": [],
    "label_names": [
      "エクスポート",
      "インポート",
      "取得",
      "データ取得"
    ],
    "body": "<p>投稿されたメトリックや監視ルールは、<a href=\"https://mackerel.io/ja/api-docs/\">API</a> もしくはCLI ツールの <a href=\"https://mackerel.io/ja/docs/entry/advanced/cli\">mkr</a> にてダウンロードできます。</p>\n<p>このページでは Linux 環境で curl コマンドを使ったサンプルを紹介します。他の環境で API を実行する場合は適宜コマンドなどを置き換えて実行してください。</p>\n<ul>\n<li><a href=\"#h_01HWSGRTETR9Z5AT5E8DTAHTQE\"><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">ダウンロードに関して</span></a></li>\n<li><a href=\"#h_01HWSGSBXGAJHM644GNNBWDXCQ\"><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">メトリックのダウンロード</span></a></li>\n<li><a href=\"#h_01HWSGQS4PWT4FR3F8TZ8KTW3V\">監視ルールのダウンロード</a></li>\n<li><a href=\"#h_01H096AFA2F1QTP2CPDPZGNJ5X\">JSON形式で出力された内容をCSV形式へ変換する</a></li>\n</ul>\n<h2 id=\"h_01HWSGRTETR9Z5AT5E8DTAHTQE\"><strong>ダウンロードに関して</strong></h2>\n<ul>\n<li><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">Webコンソールからのダウンロードには対応していません。</span></li>\n<li>\n<span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">ダウンロードできるのはAPIによる取得が可能な項目に限ります。</span>\n<ul>\n<li><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">監視ルールのうち、チェック監視についてはダウンロードに対応していません。</span></li>\n</ul>\n</li>\n<li>\n<span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">APIおよびmkrいずれの場合も出力フォーマットはJSON形式となります。</span>\n<ul>\n<li>CSV形式での出力方法については「<a style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; background-color: #ffffff;\" href=\"#h_01H096AFA2F1QTP2CPDPZGNJ5X\" target=\"_self\">JSON形式で出力された内容をCSV形式へ変換する</a><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">」をご参照ください。</span>\n</li>\n</ul>\n</li>\n<li>mkrを使用する場合は事前に<a style=\"background-color: #ffffff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\" href=\"https://mackerel.io/ja/docs/entry/advanced/cli\" target=\"_blank\" rel=\"noopener noreferrer\">こちらのページ</a><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">を参考にインストールしてください。</span>\n<ul>\n<li><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">Windows環境ではmackerel-agentに同梱されています。</span></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"h_01HWSGSBXGAJHM644GNNBWDXCQ\"><strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\">メトリックのダウンロード</span></strong></h2>\n<h3 id=\"h_01HWVFJ9CM72JXMWY6BP7AY6NZ\"><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\">メトリックの取得に関して</span></h3>\n<ul>\n<li>\n<span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">指定するメトリック名に関して</span>\n<ul>\n<li>mackerel-agent が投稿するシステムメトリック名は以下をご参照ください。\n<ul>\n<li><a href=\"https://mackerel.io/ja/docs/entry/spec/metrics\" target=\"_blank\" rel=\"noopener noreferrer\">メトリック仕様 - Mackerel ヘルプ </a></li>\n</ul>\n</li>\n<li>プラグインによって登録されたカスタムメトリック名は次のような方法でご確認ください。\n<ul>\n<li>オーガニゼーションの<a href=\"https://mackerel.io/my/graph-defs\" target=\"_blank\" rel=\"noopener noreferrer\">グラフ定義</a>から確認する（グラフ定義については<a style=\"background-color: #ffffff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\" href=\"https://mackerel.io/ja/docs/entry/advanced/custom-metrics#graph-schema\" target=\"_blank\" rel=\"noopener noreferrer\">「グラフ定義を指定する」</a><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">をご参照ください）。</span>\n</li>\n<li>mkr metric-names -H &lt;ホストID&gt; を実行し、ホストに登録されているメトリックを確認する。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>指定する期間に関して\n<ul>\n<li>epoch秒（UNIX時間）で指定します。</li>\n<li>APIおよびmkrでメトリックを取得する際、指定した期間に応じてメトリックの粒度が変化し、取得できる値もその粒度での平均値になります。1分粒度の値を取得する場合は、指定する期間を20時間以下にしてください。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"h_01HWVGRNE8N86TRKJQMQW1DBYQ\"><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\">APIによるメトリックの取得方法</span></h3>\n<ul>\n<li>メトリック取得APIに関する詳細は、以下のAPIドキュメントをご参照ください。\n<ul>\n<li>\n<a href=\"https://mackerel.io/ja/api-docs/entry/host-metrics#get\">ホストのメトリックの値の取得 - Mackerel API ドキュメント (v0)</a> </li>\n<li><a href=\"https://mackerel.io/ja/api-docs/entry/service-metrics#get\">サービスメトリックの値の取得 - Mackerel API ドキュメント (v0)</a></li>\n</ul>\n</li>\n<li>以下は curl コマンドを使って loadavg1 のメトリックを取得するサンプルです。</li>\n</ul>\n<pre>$ curl \\<br>-s https://api.mackerelio.com/api/v0/hosts/<em>&lt;ホストID&gt;</em>/metrics?name=loadavg1&amp;from=<em>&lt;epoch秒&gt;</em>&amp;to=<em>&lt;epoch秒&gt;</em> \\<br>-H 'Content-Type: application/json' \\<br>-H 'X-Api-Key: <em>&lt;APIキー&gt;</em>' \\<br>-X GET<br><br>{\"metrics\":[{\"time\":1617163080,\"value\":0.27},{\"time\":1617163140,\"value\":0.13}, ...]}</pre>\n<h3 id=\"01HWVGSA0ZRY0RPVSR0EMERPYN\"><span class=\"wysiwyg-font-size-small\" style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\">mkrによるメトリックの取得方法</span></h3>\n<ul>\n<li>mkr metrics や mkr fetch にて取得できます。</li>\n<li>以下は mkr metrics コマンドを使って loadavg1 のメトリックを取得するサンプルです。</li>\n</ul>\n<pre>$ mkr metrics --host <em>&lt;ホストID&gt; </em>--name loadavg1 --from <em>&lt;epoch秒&gt;</em> --to <em>&lt;epoch秒&gt;<br>[<br>  {<br>    \"time\": 1617163080,<br>    \"value\": 0.27<br>  },<br>  :<br></em>]</pre>\n<h2 id=\"h_01HWSGQS4PWT4FR3F8TZ8KTW3V\"><strong><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\">監視ルールのダウンロード</span></strong></h2>\n<h3 id=\"h_01F3BYE72H6JS63B85NTF4Z0Q9\"><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\">APIによる監視ルールの取得方法</span></h3>\n<ul>\n<li>監視ルール取得APIに関する情報は、以下のAPIドキュメントをご参照ください。\n<ul>\n<li><a href=\"https://mackerel.io/ja/api-docs/entry/monitors#list\" target=\"_blank\" rel=\"noopener noreferrer\">監視ルールの一覧 - Mackerel API ドキュメント (v0)</a></li>\n<li><a href=\"https://mackerel.io/ja/api-docs/entry/monitors#get\" target=\"_blank\" rel=\"noopener noreferrer\">監視ルールの取得 - Mackerel API ドキュメント (v0)</a></li>\n</ul>\n</li>\n<li>監視ルールの取得APIで個別に監視ルールを取得する場合、<em>monitorId</em> に指定する値は以下のいずれかを参考に指定してください。\n<ul>\n<li>監視ルールの一覧APIのレスポンスに含まれる、各監視ルールの <em>id</em> の値</li>\n<li>Webコンソールで監視ルール詳細画面を開いたURL中の「monitor=<strong><em>xxxxxxx</em></strong>」の値</li>\n</ul>\n</li>\n<li>以下は curl コマンドを使って監視ルールを取得するサンプルです。</li>\n</ul>\n<pre>$ curl \\<br>-s https://api.mackerelio.com/api/v0/monitors/<em>&lt;monitorId&gt;</em> \\<br>-H 'Content-Type: application/json' \\<br>-H 'X-Api-Key: <em>&lt;APIキー&gt;</em>' \\<br>-X GET<br><br>{\"monitor\":{\"duration\":1,\"maxCheckAttempts\":3,\"critical\":95,\"isMute\":false,\"metric\":\"cpu%\",\"excludeScopes\":[],\"name\":\"CPU %\",\"warning\":80,\"id\":\"xxxxxxxx\",\"scopes\":[],\"type\":\"host\",\"operator\":\"&gt;\"}}</pre>\n<h3 id=\"h_01F3BYECQYZ3ARJHY8BWK23YQ3\"><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\">mkrによる監視ルールの取得方法</span></h3>\n<ul>\n<li>mkr monitors pull にて取得できます。\n<ul>\n<li>コマンドが実行されたディレクトリに monitors.json が作成されます。</li>\n<li>mkr monitors は pull（取得）のほか、diff（差分確認）や push（更新）にも対応しています。</li>\n</ul>\n</li>\n<li>以下は mkr monitors コマンドを使って監視ルールを取得するサンプルです。</li>\n</ul>\n<pre>$ mkr monitors pull<br>      info Monitor rules are saved to 'monitors.json' (6 rules).</pre>\n<h2 id=\"h_01H096AFA2F1QTP2CPDPZGNJ5X\"><strong>JSON形式で出力された内容をCSV形式へ変換する</strong></h2>\n<p>APIからのレスポンスであるJSON文字列をjqコマンドにパイプして渡すことで、jqでフィルター処理をしてCSV形式へ変換できます。</p>\n<pre>$ curl \\<br>-s https://api.mackerelio.com/api/v0/hosts/<em>&lt;ホストID&gt;</em>/metrics?name=loadavg1&amp;from=<em>&lt;epoch秒&gt;</em>&amp;to=<em>&lt;epoch秒&gt;</em> \\<br>-H 'Content-Type: application/json' \\<br>-H 'X-Api-Key: <em>&lt;APIキー&gt;</em>' \\<br>-X GET \\<br>| jq '.[] | .[] | [.time, .value] | @csv'<br><br>1617163080,0.27<br>1617163140,0.13<br> :</pre>\n<p>mkrも同様に--jqオプションでフィルター処理をしてCSV形式へ変換できます（<a style=\"background-color: #ffffff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\" href=\"https://github.com/itchyny/gojq\" target=\"_blank\" rel=\"noopener noreferrer\">gojq</a><span style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\">の仕様に準拠します）。</span></p>\n<pre class=\"loom_code prettyprint prettyprinted\">mkr metrics --host <em>&lt;ホストID&gt;</em> --name loadavg1 --from <em>&lt;epoch秒&gt;</em> --to <em>&lt;epoch秒&gt;</em> --jq '.[] | [.time,.value] | @csv'<br><br>1617163080,0.27<br>1617163140,0.13<br>:</pre>"
  }
}

{"article":{"id":900006365223,"url":"https://mackerelio.zendesk.com/api/v2/help_center/ja/articles/900006365223.json","html_url":"https://support.mackerel.io/hc/ja/articles/900006365223","author_id":390085917472,"comments_disabled":true,"draft":false,"promoted":false,"position":5,"vote_sum":0,"vote_count":0,"section_id":360007911812,"created_at":"2021-03-30T07:28:35Z","updated_at":"2021-12-21T08:53:23Z","name":"メトリックや監視ルールをダウンロードすることは出来ますか？","title":"メトリックや監視ルールをダウンロードすることは出来ますか？","source_locale":"ja","locale":"ja","outdated":false,"outdated_locales":[],"edited_at":"2021-04-15T23:40:12Z","user_segment_id":null,"permission_group_id":1305651,"content_tag_ids":[],"label_names":["エクスポート","インポート","取得","データ取得"],"body":"\u003cp\u003eMackerelが管理しているメトリックや監視ルールは、APIやCLIツールからダウンロードしてお手元で管理していただけます。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eWebコンソール上からCSV形式などでのダウンロードには対応しておりません。\u003c/li\u003e\n\u003cli\u003eAPI、CLIツールの何れもJSON形式での出力となります。\u003c/li\u003e\n\u003cli\u003eCLIツールのインストールや使い方については以下をご確認ください。\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://mackerel.io/ja/docs/entry/advanced/cli\" target=\"_blank\" rel=\"noopener\"\u003eCLIツール mkr を使う - Mackerel ヘルプ\u003c/a\u003e \u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cspan style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\"\u003eメトリックと監視ルールの取得方法について便利なリンクとコマンドのサンプルをご紹介します。\u003c/span\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cspan style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\"\u003e\u003ca href=\"#h_01F3BYDQJM4YAJQ18BPKEKYKPG\" target=\"_self\"\u003eAPIによるメトリックの取得方法\u003c/a\u003e\u003c/span\u003e\u003c/li\u003e\n\u003cli\u003e\u003cspan style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\"\u003e\u003ca href=\"#h_01F3BYE0P9W9PQ4RKXZQGQV1VX\" target=\"_self\"\u003eCLIツール（mkr）によるメトリックの取得方法\u003c/a\u003e\u003c/span\u003e\u003c/li\u003e\n\u003cli\u003e\u003cspan style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\"\u003e\u003ca href=\"#h_01F3BYE72H6JS63B85NTF4Z0Q9\" target=\"_self\"\u003eAPIによる監視ルールの取得方法\u003c/a\u003e\u003c/span\u003e\u003c/li\u003e\n\u003cli\u003e\u003cspan style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\"\u003e\u003ca href=\"#h_01F3BYECQYZ3ARJHY8BWK23YQ3\" target=\"_self\"\u003eCLIツール（mkr）による監視ルールの取得方法\u003c/a\u003e\u003c/span\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"h_01F3BYDQJM4YAJQ18BPKEKYKPG\"\u003e\u003cspan style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\"\u003eAPIによるメトリックの取得方法\u003c/span\u003e\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e メトリック取得APIに関する詳細は、以下のAPIドキュメントをご確認ください。\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://mackerel.io/ja/api-docs/entry/host-metrics#get\" target=\"_blank\" rel=\"noopener\"\u003eホストのメトリックの値の取得 - Mackerel API ドキュメント (v0) \u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://mackerel.io/ja/api-docs/entry/service-metrics#get\" target=\"_blank\" rel=\"noopener\"\u003eサービスメトリックの値の取得 - Mackerel API ドキュメント (v0) \u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003emackerel-agent が投稿するシステムメトリック名は以下をご確認ください。\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://mackerel.io/ja/docs/entry/spec/metrics\" target=\"_blank\" rel=\"noopener\"\u003eメトリック仕様 - Mackerel ヘルプ \u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eプラグインによるカスタムメトリック名はホスト詳細画面や\u003ca href=\"https://mackerel.io/my/graph-defs\" target=\"_blank\" rel=\"noopener\"\u003eグラフ定義の画面\u003c/a\u003eなどでご確認ください。\u003cbr\u003e（グラフ定義については\u003ca href=\"https://mackerel.io/ja/docs/entry/advanced/custom-metrics#graph-schema\" target=\"_blank\" rel=\"noopener\"\u003e「グラフ定義を指定する」\u003c/a\u003eをご確認ください）\u003c/li\u003e\n\u003cli\u003e以下は curl コマンドによるloadavg1のメトリックを取得するサンプルです。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e$ curl \\\u003cbr\u003e-s https://api.mackerelio.com/api/v0/hosts/\u003cem\u003e\u0026lt;ホストID\u0026gt;\u003c/em\u003e/metrics?name=loadavg1\u0026amp;from=\u003cem\u003e\u0026lt;unixtime\u0026gt;\u003c/em\u003e\u0026amp;to=\u003cem\u003e\u0026lt;unixtime\u0026gt;\u003c/em\u003e \\\u003cbr\u003e-H 'Content-Type: application/json' \\\u003cbr\u003e-H 'X-Api-Key: \u003cem\u003e\u0026lt;APIキー\u0026gt;\u003c/em\u003e' \\\u003cbr\u003e-X GET\u003cbr\u003e\u003cbr\u003e{\"metrics\":[{\"time\":1617163080,\"value\":0.27},{\"time\":1617163140,\"value\":0.13}, ...]}\u003c/pre\u003e\n\u003ch4 id=\"h_01F3BYE0P9W9PQ4RKXZQGQV1VX\"\u003e\u003cspan style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\"\u003eCLIツール（mkr）によるメトリックの取得方法\u003c/span\u003e\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003emkr metrics や mkr fetch にて取得いただけます。\u003c/li\u003e\n\u003cli\u003e以下は mkr metrics コマンドによるloadavg1のメトリックを取得するサンプルです。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e$ mkr metrics --host \u003cem\u003e\u0026lt;ホストID\u0026gt; \u003c/em\u003e--name loadavg1 --from \u003cem\u003e\u0026lt;unixtime\u0026gt;\u003c/em\u003e --to \u003cem\u003e\u0026lt;unixtime\u0026gt;\u003cbr\u003e[\u003cbr\u003e  {\u003cbr\u003e    \"time\": 1617163080,\u003cbr\u003e    \"value\": 0.27\u003cbr\u003e  },\u003cbr\u003e  :\u003cbr\u003e\u003c/em\u003e]\u003c/pre\u003e\n\u003ch4 id=\"h_01F3BYE72H6JS63B85NTF4Z0Q9\"\u003e\u003cspan style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\"\u003eAPIによる監視ルールの取得方法\u003c/span\u003e\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e監視ルール取得APIに関する情報は、以下のAPIドキュメントをご確認ください。\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://mackerel.io/ja/api-docs/entry/monitors#list%C2%A0\" target=\"_blank\" rel=\"noopener\"\u003e監視ルールの一覧 - Mackerel API ドキュメント (v0)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://mackerel.io/ja/api-docs/entry/monitors#get\" target=\"_blank\" rel=\"noopener\"\u003e監視ルールの取得 - Mackerel API ドキュメント (v0)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e監視ルール取得APIで個別に監視ルールを取得する場合、\u003cem\u003emonitorId\u003c/em\u003e に指定する値は以下の何れかを参考に指定してください。\n\u003cul\u003e\n\u003cli\u003e監視ルール一覧APIのレスポンスに含まれる、各監視ルールの \u003cem\u003eid\u003c/em\u003e の値\u003c/li\u003e\n\u003cli\u003eWebコンソールで監視ルール詳細画面を開いた際のURL中の「monitor=\u003cstrong\u003e\u003cem\u003exxxxxxx\u003c/em\u003e\u003c/strong\u003e」の値\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eチェック監視の \u003cem\u003emonitorId\u003c/em\u003e は監視ステータス一覧APIにて、ホスト毎に設定されているチェック監視の \u003cem\u003emonitorId\u003c/em\u003e をご確認いただけます。\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://mackerel.io/ja/api-docs/entry/hosts#monitored-statuses\" target=\"_blank\" rel=\"noopener\"\u003e監視ステータスの一覧 - Mackerel API ドキュメント (v0)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cul\u003e\n\u003cli\u003e以下は curl コマンドによる監視ルールを取得するサンプルです。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e$ curl \\\u003cbr\u003e-s https://api.mackerelio.com/api/v0/monitors/\u003cem\u003e\u0026lt;monitorId\u0026gt;\u003c/em\u003e \\\u003cbr\u003e-H 'Content-Type: application/json' \\\u003cbr\u003e-H 'X-Api-Key: \u003cem\u003e\u0026lt;APIキー\u0026gt;\u003c/em\u003e' \\\u003cbr\u003e-X GET\u003cbr\u003e\u003cbr\u003e{\"monitor\":{\"duration\":1,\"maxCheckAttempts\":3,\"critical\":95,\"isMute\":false,\"metric\":\"cpu%\",\"excludeScopes\":[],\"name\":\"CPU %\",\"warning\":80,\"id\":\"xxxxxxxx\",\"scopes\":[],\"type\":\"host\",\"operator\":\"\u0026gt;\"}}\u003c/pre\u003e\n\u003ch4 id=\"h_01F3BYECQYZ3ARJHY8BWK23YQ3\"\u003e\u003cspan style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 1.1em;\"\u003eCLIツール（mkr）による監視ルールの取得方法\u003c/span\u003e\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003emkr monitors pull にて取得いただけます。\n\u003cul\u003e\n\u003cli\u003e取得できる監視ルールはWebコンソールで設定いただいた監視ルールのみとなります。\u003c/li\u003e\n\u003cli\u003eコマンドが実行されたディレクトリに monitors.json が作成されます。\u003c/li\u003e\n\u003cli\u003eチェック監視は mackerel-agent.conf をお手元で管理いただくようお願いします。\u003c/li\u003e\n\u003cli\u003emkr monitors は pull（取得）以外にも、diff（差分確認）や push（更新）にも対応してます。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e以下は mkr コマンドによる監視ルールを取得するサンプルです。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e$ mkr monitors pull\u003cbr\u003e      info Monitor rules are saved to 'monitors.json' (6 rules).\u003c/pre\u003e"}}